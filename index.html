<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>üí™ Cheer Workout Timer</title>
<style>
:root { font-size: clamp(14px, 4vw, 20px); }
html { touch-action: manipulation; }
body{
  font-family:"Hiragino Sans","Yu Gothic",system-ui,-apple-system,sans-serif;
  margin:0; padding:min(5vw, 1rem); min-height:100vh;
  background:linear-gradient(135deg,#ffeef8 0%,#f0f8ff 50%,#fff0f8 100%);
  color:#5a4b7a; box-sizing:border-box;
}
.container{
  max-width: min(90vw, 28rem); width: 100%; margin: 0 auto; padding: min(4vw, 1.25rem);
  background: rgba(255,255,255,.9); border-radius: min(3vw, 1.25rem);
  box-shadow: 0 0.5rem 2rem rgba(0,0,0,.1);
}

h1{
  font-size: 1.6rem; margin-bottom: .75rem; text-align:center; font-weight:bold;
  color:#ff6b9d;
}

.row{ margin: 1rem 0; display:flex; gap:.75rem; align-items:center; flex-wrap:wrap; justify-content:center; }
label{ font-weight:bold; color:#8b7aa8; font-size:1rem; }
input[type="number"]{
  width: 4.2rem; padding:.6rem; font-size:1rem; border: .125rem solid #ffc1e3; border-radius: 1rem;
  background: rgba(255,255,255,.85); text-align:center; color:#5a4b7a; font-weight:bold;
}

button{
  padding:min(3vw, .8rem) min(4vw, 1.1rem); border:none; border-radius:min(3vw, 1.1rem); 
  background:linear-gradient(45deg,#ff6b9d,#ff8fab);
  color:#fff; font-size:1rem; font-weight:bold; cursor:pointer;
  min-height: 44px; touch-action: manipulation;
  position: relative; z-index: 10;
}
button:hover, button:active{ transform:translateY(-.15rem); }
#stopBtn{ background:linear-gradient(45deg,#a8a8a8,#c0c0c0); }

#status{
  margin-top:1rem; font-size:1.2rem; text-align:center; font-weight:bold; color:#ff6b9d;
  padding:.8rem; background:rgba(255,193,227,.1); border-radius:1rem;
}
#msg{
  margin-top: .8rem; font-size:1rem; min-height:2em; text-align:center;
  padding:.75rem; border-radius:1rem; color:#8b7aa8; font-weight:bold;
}
</style>
</head>
<body>
<div class="container">
  <h1>üí™ Cheer Workout Timer</h1>

  <div class="row">
    <label>„Çª„ÉÉ„Éà <input id="sets" type="number" value="8" min="1" /></label>
    <label>‰ΩúÊ•≠(Áßí) <input id="work" type="number" value="45" min="5" /></label>
    <label>‰ºëÊÜ©(Áßí) <input id="rest" type="number" value="15" min="0" /></label>
  </div>

  <div class="row">
    <button id="startBtn">üåü Start</button>
    <button id="stopBtn">‚è∏Ô∏è Stop</button>
  </div>

  <div id="status">üí§ Stopped</div>
  <div id="msg">‚Ä¶</div>
</div>

<script>
// Èü≥Â£∞„É™„Çπ„Éà
const AUDIO_FILES = [
  'audio/ganbare.mp3',
  'audio/ganbatte.mp3', 
  'audio/sono_choshi.mp3',
  'audio/hurray.mp3'
];

const REST_AUDIO = 'audio/ato_chotto.mp3';

const COMPLETE_FILES = [
  'audio/yatta_ne.mp3',
  'audio/yatta_long.mp3',
  'audio/otsukaresama.mp3'
];

// „É©„É≥„ÉÄ„É†ÈÅ∏Êäû
function pick(arr){ return arr[Math.floor(Math.random() * arr.length)]; }

// „Ç∑„É≥„Éó„É´„Å™Èü≥Â£∞ÂÜçÁîü
function playAudio(file, text) {
  try {
    const audio = new Audio(file);
    audio.volume = 0.7;
    audio.play().catch(e => console.log('Audio failed:', e));
    document.getElementById('msg').textContent = text || '‚ô™';
  } catch (e) {
    console.log('Audio error:', e);
    document.getElementById('msg').textContent = text || '‚ô™';
  }
}

// „Çø„Ç§„Éû„ÉºÊ©üËÉΩ
let running = false;
let timerId = null;

function sleep(ms) { 
  return new Promise(resolve => { 
    timerId = setTimeout(resolve, ms); 
  }); 
}

async function run() {
  if (running) return;
  
  running = true;
  const sets = parseInt(document.getElementById('sets').value, 10);
  const work = parseInt(document.getElementById('work').value, 10);
  const rest = parseInt(document.getElementById('rest').value, 10);

  for (let i = 1; i <= sets && running; i++) {
    // „Çª„ÉÉ„ÉàÈñãÂßã
    document.getElementById('status').textContent = `üí™ Set ${i}/${sets} - WORK`;
    
    const workFile = pick(AUDIO_FILES);
    playAudio(workFile, '„Åå„Çì„Å∞„Çå„ÉºÔºÅ');
    
    await sleep(work * 1000);
    if (!running) break;

    // ‰ºëÊÜ©
    if (i < sets && rest > 0) {
      document.getElementById('status').textContent = `üòå Rest (${rest}s)`;
      playAudio(REST_AUDIO, '„ÅÇ„Å®„Å°„Çá„Å£„Å®„ÄúÔºÅ');
      await sleep(rest * 1000);
    }
  }

  if (running) {
    document.getElementById('status').textContent = 'üéâ Complete!';
    const completeFile = pick(COMPLETE_FILES);
    playAudio(completeFile, '„ÅäÁñ≤„ÇåÊßòÔºÅ');
  }
  
  running = false;
}

// iOSÂØæÁ≠ñÔºö„ÇØ„É™„ÉÉ„ÇØÊôÇ„Å´Âç≥Â∫ß„Å´Èü≥Â£∞„ÉÜ„Çπ„Éà
document.getElementById('startBtn').addEventListener('click', (e) => {
  e.preventDefault();
  
  if (!running) {
    // iOSÂØæÁ≠ñÔºö„É¶„Éº„Ç∂„ÉºÊìç‰ΩúÁõ¥Âæå„Å´Èü≥Â£∞ÂÜçÁîü
    const testAudio = new Audio('audio/ganbare.mp3');
    testAudio.volume = 0.7;
    testAudio.play().then(() => {
      console.log('Audio unlocked');
      run();
    }).catch(() => {
      console.log('Audio blocked, starting anyway');
      run();
    });
  }
});

document.getElementById('stopBtn').addEventListener('click', () => {
  running = false;
  clearTimeout(timerId);
  document.getElementById('status').textContent = 'üí§ Stopped';
  document.getElementById('msg').textContent = '‚Ä¶';
});
</script>
</body>
</html>